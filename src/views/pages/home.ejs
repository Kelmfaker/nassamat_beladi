<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thinker Honey</title>
    <link rel="stylesheet" href="/public/static/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">




</head>
<body>

    <header>
        <div class="logo">Thinker Honey</div>
  <div class="logo"> <img src="public/static/img/logo2.png" class="logo1"></div>
      <div class="navigation">



    
      <div class="links" id="nav-links">

       <%- include('partials/publicnavbar') %>

    </div>

    <div class="buttons-container">
      <button id="signup-btn" onclick="redirectToSignup()">تسجيل</button>
      <button id="login-btn" onclick="redirectToLogin()">دخول</button>
    </div>

   <div class="cart-icon">
      <a href="../../public/cart.html" title="سلة المشتريات">
        <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>

      </a>
    </div>
  <div class="hamburger" id="menu-toggle" onclick="toggleMenu()">☰</div>

 <div id="message" style="display:none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
 background: #28a745; color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000;">
</div>

</div>





  </header>


    <section class="main" id="main">
        <div class="main-image"></div>




  <div class="main-content">
    <h2>مرحبا بكم في متجر<br><span>Thinker Honey</span></h2>
    <h2>لبيع أجود أنواع العسل الحر</h2>

    <a href="#store" class="main-btn">تسوق الآن</a>

    <div class="social-icon">
      تواصل معنا عبر
      <a href="https://www.instagram.com/thinker_honey/"><i class="fa-brands fa-instagram"></i></a>
      <a href="https://www.facebook.com/profile.php?id=61567279060085"><i class="fa-brands fa-facebook-f"></i></a>
      <a href="https://wa.me/c/212708318135"><i class="fa-brands fa-whatsapp"></i></a>
    </div>
  </div>

  

</section>

   
    <section class="content">




    
    
 <div class="promo-banner">
  <div class="promo-container">
    <p>
تجدون في متجرنا <span>Thinker Honey</span> عروض وتخفيضات حصرية  <strong>على كل منتجات العسل المتوفرة</strong>
  </p>
  </div>
    
</div>
 <form action="/admin/products/" method="GET">
     <% if (products && products.length > 0) { %>
        <% products.forEach((product, index) => { %>


<div class="products" id="store">

  <div id="productModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <p id="modal-text"></p>
  </div>
</div>

    <!-- Product 1 -->
    <div class="product">
        <div class="prd-img">
 <% if (product && product.image) { %>
      <img src="/public/static/img/<%= product.image %>" width="100" alt="صورة المنتج">
    <% } %>
          </div>
        <div class="prd-description">
            <strong class="prd-title">
                  <span> <%= product.name %></span>

            <div class="prices">
      <span class="old-price">400Dh</span>
      <span class="new-price">350Dh</span>
    </div>
            </strong>
            <div class="more-des">
<p class="description"><%= product.description %>

            </p>
                <a href="#" class="more" data-description="<%= product.description %>">المزيد</a>


            
            </div>
        </div>

        
        <div class="center-button">
            <button class="qty-btn" type="button" onclick="changeQuantity(this, -1)">➖</button>
            Kg <span class="quantity">1</span>
            <button class="qty-btn" type="button" onclick="changeQuantity(this, 1)">➕</button>
          
        <button class="add-to-cart"
        data-id="<%= product._id %>"
        data-name="<%= product.name %>""
        data-price="<%= product.price %>"
        data-image="<%= product.image %>"
        data-max="<%= product.stock %>" <!-- الحد الأقصى هنا 5 -->

        إضافة إلى السلة
    </button>      
                  </div>


    
    </div>

     

</div>

 <% }) %>
      <% } else { %>
        <h3>لا توجد منتجات</h3>
      <% } %>
  </form>

</section>




    <%- include('partials/footer') %>




<script>



// إذا تم إرسال الطلب مسبقًا عبر واتساب
window.addEventListener("DOMContentLoaded", () => {
  const orderSent = localStorage.getItem("orderSent");
  if (orderSent === "true") {
    // الآن فقط نحذف السلة
    localStorage.removeItem("lastOrder");
    localStorage.removeItem("orderSent");
  }
});



function changeQuantity(button, delta) {
  const productDiv = button.closest('.product');
  const quantitySpan = productDiv.querySelector('.quantity');
  let qty = parseInt(quantitySpan.textContent);

  const addToCartBtn = productDiv.querySelector('.add-to-cart');
  const max = parseInt(addToCartBtn.dataset.max) || 20; // 20 كحد افتراضي

  qty += delta;
  if (qty < 1) qty = 1;
  if (qty > max) qty = max;

  quantitySpan.textContent = qty;
}

function showMessage(text) {
  const messageDiv = document.getElementById('message');
  messageDiv.textContent = text;
  messageDiv.style.display = 'block';

  setTimeout(() => {
    messageDiv.style.display = 'none';
  }, 3000);
}


document.querySelectorAll('.add-to-cart').forEach(button => {
  button.addEventListener('click', () => {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    const id = button.dataset.id;
    const name = button.dataset.name;
    const price = parseFloat(button.dataset.price);
    const image = button.dataset.image;
    const max = parseInt(button.dataset.max);

    const productDiv = button.closest('.product');
    const quantity = parseInt(productDiv.querySelector('.quantity').textContent);

    const existingProduct = cart.find(p => p.id === id);

    if (existingProduct) {
      if (existingProduct.quantity + quantity <= existingProduct.max) {
        existingProduct.quantity += quantity;
      } else {
        alert('لقد وصلت إلى الحد الأقصى لهذا المنتج');
        return;  // لا تضيف الكمية وتتوقف
      }
    } else {
      if (quantity <= max) {
        cart.push({ id, name, price, image, quantity, max });
      } else {
        alert('الكمية المطلوبة تتجاوز الحد الأقصى المتاح');
        return;
      }
    }

    localStorage.setItem('cart', JSON.stringify(cart));

showMessage(`تمت إضافة ${quantity} من "${name}" إلى السلة`);
  updateCartCount();


  });
});

 function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    let totalItems = 0;
    cart.forEach(item => {
      totalItems += item.quantity;
    });
    document.getElementById('cart-count').textContent = totalItems;
  }

  // شغلها مباشرة عند تحميل الصفحة
  updateCartCount();

const toggleButton = document.getElementById("menu-toggle");
const menu = document.getElementById("nav-links");

toggleButton.addEventListener("click", function (e) {
  e.stopPropagation(); // يمنع الحدث من الوصول إلى document
  menu.classList.toggle("show");
});

// إغلاق القائمة عند الضغط خارجها
document.addEventListener("click", function (event) {
  if (!menu.contains(event.target) && !toggleButton.contains(event.target)) {
    menu.classList.remove("show");
  }
});
// إغلاق عند الضغط على أحد الروابط داخل القائمة
const links = menu.querySelectorAll("a");
links.forEach(link => {
  link.addEventListener("click", () => {
    menu.classList.remove("show");
  });
});

// إغلاق القائمة عند تمرير الصفحة
window.addEventListener("scroll", () => {
  menu.classList.remove("show");
});

  // إغلاق عند الضغط خارج القائمة
document.addEventListener("click", function (event) {
  const menu = document.getElementById("nav-links");
  const button = event.target.closest("button");


  // إذا كان الضغط ليس داخل القائمة أو زرها
  if (!menu.contains(event.target) && !button) {
    menu.classList.remove("show");
  }
});



  // تشغيل النافذة عند الضغط على "المزيد"
  document.querySelectorAll('.more').forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      const text = this.getAttribute('data-description');
      document.getElementById('modal-text').innerText = text;
      document.getElementById('productModal').style.display = 'block';
    });
  });

  // إغلاق النافذة
  function closeModal() {
    document.getElementById('productModal').style.display = 'none';
  }

  // إغلاق بالضغط خارج المحتوى
  window.onclick = function(e) {
    const modal = document.getElementById('productModal');
    if (e.target == modal) {
      closeModal();
    }
  }

 // Redirect to the signup page
    function redirectToSignup() {
      window.location.href = "/public/authentication/signup.html";
    }

    // Redirect to the login page
    function redirectToLogin() {
      window.location.href = "/public/authentication/login.html";
    }


</script>

</body>
</html>
  

