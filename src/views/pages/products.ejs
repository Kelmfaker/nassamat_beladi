<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>إدارة المنتجات</title>

</head>
<body>

   <% if (user && user.role === 'admin') { %>
    <%- include("partials/admin-header") %>
  <% } else { %>
    <%- include("partials/header") %>
  <% } %>

    <div class="content">



        <h1>إدارة المنتجات</h1>
          <!-- إضافة منتج -->
   <div class="dive">
       <h3>   اضافة منتج جديد   </h3>

  <form action="/admin/products/add" method="POST">
    <input type="text" name="name" placeholder="اسم المنتج" required>
            <textarea type="text" name="description" placeholder="الوصف" ></textarea>
        <input type="number" name="price" placeholder="الثمن" required>
        <input type="number" name="promoPrice" placeholder=" ثمن التخفيض"  >
        <input type="number" name="stock" placeholder="المخزون"  >
       <label>متوفر</label> <input type="checkbox" name="inStock" >
               <input type="file" name="image" >


<select name="category" required>
  <option value="">اختر الفئة</option>
  <% categories.forEach(cat => { %>
    <option value="<%= cat._id %>"><%= cat.name %></option>
  <% }) %>
</select>

    <button type="submit">إضافة</button>


  </form>


</div>
    
    </div>

          <div class="table-container">
  <h3>قائمة المنتجات</h3>

  <% if (products && products.length > 0) { %>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>الاسم</th>
          <th>الوصف</th>
          <th>السعر</th>
          <th>السعر بعد التخفيض</th>
          <th>المخزون</th>
          <th>متوفر</th>
          <th>الصورة</th>
          <th>إجراءات</th>
        </tr>
      </thead>
      <tbody>
        <% products.forEach((product, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td><input type="text" name="name" value="<%= product.name %>"></td>
            <td><textarea name="description" rows="2"><%= product.description %></textarea></td>
            <td><input type="number" name="price" value="<%= product.price %>"></td>
            <td><input type="number" name="promoPrice" value="<%= product.promoPrice %>"></td>
            <td><input type="number" name="stock" value="<%= product.stock %>"></td>
            <td><input type="checkbox" <%= product.inStock ? 'checked' : '' %>></td>
            <td>
              <% if (product.image) { 
                   const imgSrc = product.image.startsWith('/') ? product.image : ('/images/' + product.image);
                   const base = imgSrc.replace(/\.(jpg|jpeg|png|webp)$/i, '');
              %>
                <img src="<%= imgSrc %>" width="70" srcset="<%= base %>-sm.jpg 400w, <%= base %>-md.jpg 800w" sizes="70px">
              <% } %>
            </td>
            <td>
              <form action="/admin/products/edit/<%= product._id %>" method="POST" enctype="multipart/form-data">
                <button type="submit">تعديل</button>
              </form>
              <form action="/admin/products/delete/<%= product._id %>" method="GET" onsubmit="return confirm('هل أنت متأكد من الحذف؟')">
                <button type="submit">حذف</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <h3>لا توجد منتجات</h3>
  <% } %>
</div>


    
</body>
</html>
