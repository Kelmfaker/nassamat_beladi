<header>
  <nav>
    <div class="logo">
    </div>

    <button id="menu-toggle" class="menu-toggle" aria-label="فتح/إغلاق القائمة" aria-expanded="false" aria-controls="nav-links">
      <span></span><span></span><span></span>
    </button>

    <div class="nav-links" id="nav-links">
      <a href="/admin" class="nav-link">لوحة التحكم</a>
      <a href="/admin/products" class="nav-link">المنتجات</a>
      <a href="/admin/categories" class="nav-link">الأقسام</a>
  <a href="/admin/users" class="nav-link">المستخدمين</a>
    <a href="/admin/messages" class="nav-link">الرسائل <span class="nav-badge"><%= typeof adminMessagesCount !== 'undefined' ? adminMessagesCount : 0 %></span></a>
      <a href="/orders/admin/all" class="nav-link">الطلبات</a>
      <a href="/" class="nav-link">الموقع الرئيسي</a>
      <a href="/auth/logout" class="nav-link">تسجيل الخروج</a>
    </div>
  </nav>
</header>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const btn = document.getElementById('menu-toggle');
  const menu = document.getElementById('nav-links');
  if (!btn || !menu) return;

  const closeMenu = () => {
    menu.classList.remove('show');
    btn.classList.remove('active');
    btn.setAttribute('aria-expanded', 'false');
  };

  const openMenu = () => {
    menu.classList.add('show');
    btn.classList.add('active');
    btn.setAttribute('aria-expanded', 'true');
    // move focus to first link for keyboard users
    const first = menu.querySelector('a');
    if (first) first.focus();
  };

  const toggleMenu = (e) => {
    // allow keyboard activation as well
    if (e && e.type === 'keydown' && !(e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar')) return;
    e && e.preventDefault();
    e && e.stopPropagation();
    const willOpen = !menu.classList.contains('show');
    willOpen ? openMenu() : closeMenu();
  };

  btn.addEventListener('click', toggleMenu);
  btn.addEventListener('keydown', toggleMenu);
  // also listen to pointer/touch events to improve responsiveness on mobile
  btn.addEventListener('pointerdown', function (e) {
    try {
      e.stopPropagation();
      toggleMenu(e);
    } catch (err) {
      console.error('menu-toggle pointerdown error', err);
    }
  });

  // Close when clicking outside or when a nav link is clicked
  document.addEventListener('click', (e) => {
    if (!menu.contains(e.target) && !btn.contains(e.target)) closeMenu();
  });

  menu.addEventListener('click', (e) => {
    const target = e.target.closest('a');
    if (target) {
      // close after navigation on small screens
      closeMenu();
    }
  });

  // Close menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' || e.key === 'Esc') closeMenu();
  });

  // close on scroll to avoid overlaying content
  window.addEventListener('scroll', closeMenu, { passive: true });
});
</script>