<header>
  <nav>
    <div class="logo">
      <img src="/images/logo nassamat bladi copie.png" alt="Nassamat Beladi" />
    </div>

    <button id="menu-toggle" class="menu-toggle" aria-label="فتح/إغلاق القائمة" aria-expanded="false" aria-controls="nav-links">
      <span></span><span></span><span></span>
    </button>

    <div class="nav-links" id="nav-links">
      <a href="/" class="nav-link">الرئيسية</a>
      <a href="#store" class="nav-link">المتجر</a>
      <a href="/cart" class="nav-link">السلة (<span id="cart-count">0</span>)</a>
      <a href="/contact" class="nav-link">اتصل بنا</a>
      <% if (user) { %>
        <a href="/users/profile" class="nav-link"><i class="fas fa-user"></i> حسابي</a>
        <a href="/auth/logout" class="nav-link">تسجيل الخروج</a>
      <% } else { %>
        <a href="/auth/login" class="nav-link">تسجيل الدخول</a>
        <a href="/auth/signup" class="nav-link">إنشاء حساب</a>
      <% } %>
    </div>
  </nav>
</header>

<script>
// cart count
(function(){
  const cart = JSON.parse(localStorage.getItem('cart')||'[]');
  const total = cart.reduce((s,i)=>s+(i.quantity||0),0);
  const el = document.getElementById('cart-count');
  if (el) el.textContent = total;
})();

// mobile menu
(function(){
  const btn = document.getElementById('menu-toggle');
  const menu = document.getElementById('nav-links');
  if (!btn || !menu) return;
  const closeMenu = () => {
    menu.classList.remove('show');
    btn.classList.remove('active');
    btn.setAttribute('aria-expanded','false');
  };
  btn.addEventListener('click', (e)=>{
    e.stopPropagation();
    const willOpen = !menu.classList.contains('show');
    menu.classList.toggle('show', willOpen);
    btn.classList.toggle('active', willOpen);
    btn.setAttribute('aria-expanded', String(willOpen));
  });
  document.addEventListener('click', (e)=>{
    if (!menu.contains(e.target) && !btn.contains(e.target)) closeMenu();
  });
  menu.querySelectorAll('a').forEach(a=>a.addEventListener('click', closeMenu));
  window.addEventListener('scroll', closeMenu);
})();
</script>
